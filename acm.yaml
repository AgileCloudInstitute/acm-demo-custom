## Copyright 2022 Green River IT (GreenRiverIT.com) as described in LICENSE.txt distributed with this project on GitHub.  
## Start at https://github.com/AgileCloudInstitute?tab=repositories    

#Start cf-demo system
cf-demo:
  keysDir: $Default
  cloud: aws
  organization: a1b2c
  tags:
    networkName: name-of-vnet
    systemName: name-of-system
    environmentName: name-of-environment
    ownerName: name-of-owner
  foundation:
    instanceName: custom
    templateName: aws-building-blocks/cf/foundation.json
    controller: $customController.path/to/program
    preprocessor: 
      locationOn: aws-building-blocks/scripts/hello1.py
      commandOn: python $location
      locationOff: aws-building-blocks/scripts/hello2.py
      commandOff: python $location
    postprocessor:
      locationOn: aws-building-blocks/scripts/hello3.py
      commandOn: python $location
      locationOff: aws-building-blocks/scripts/hello4.py
      commandOff: python $location
    mappedVariables:
      vpcCIDR: 10.0.0.0/16
    images: 
      - instanceName: custom-image
        templateName: aws-building-blocks/cf/image.json
        controller: $customController.path/to/program
        mappedVariables: 
          VpcId: $customFunction.foundationOutput.VpcId
          RouteTableId: $customFunction.foundationOutput.RouteTableId
          KeyName: $keys.KeyName
          SSHLocation: 0.0.0.0/0
          InstanceType: t2.small
          AvailabilityZone: us-west-2a
          CidrBlock: 10.0.0.0/24
  serviceTypes:
    subnetsWithScaleSet:
      instances:
        - instanceName: custom-scaleset
          templateName: aws-building-blocks/cf/ec2withcustomimg.json
          controller: $customController.path/to/program
          imageName: cf-image-demo
          preprocessor: 
            locationOn: aws-building-blocks/scripts/hello1.py
            commandOn: python $location
            locationOff: aws-building-blocks/scripts/hello2.py
            commandOff: python $location
          postprocessor:
            locationOn: aws-building-blocks/scripts/hello3.py
            commandOn: python $location
            locationOff: aws-building-blocks/scripts/hello4.py
            commandOff: python $location
          mappedVariables:
            VpcId: $customFunction.foundationOutput.VpcId
            RouteTableId: $customFunction.foundationOutput.RouteTableId
            KeyName: $keys.KeyName
            InstanceType: t2.small
            SSHLocation: 0.0.0.0/0
            ImageId: $customFunction.mostRecentImage.cf-image-demo
            AvailabilityZone: us-west-2a
            CidrBlock: 10.0.0.0/24
